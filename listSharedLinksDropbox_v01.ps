# Define your Dropbox API token
$accessToken = "sl.u.AFE-2vTzzuRvEK_vyFTIxCD1ZiZ5C8akzGYwUEluqFmkY-0Clm4zLq-Fv_-3bwrh9QFVNgXLmyTIyHlVzKr5esHfpWFRy4PoItDc3mdL0jXLe9vTuV1nOnfOgyTJrZLF5d9zixb1mxjfBJ4WOOuElhNrY1y5L4fEpA56N7EcBvmzQDOdWX6WTQauQ42Gu3mgnvv1rvkvSsNeH6rSbdnmlfUiihrkJhgZMSRDMY7x5bFgx56a-h3xOj5iCr5mbK0Adaw9xAmwVSJ900AOSw1H1LbsvbxZGQMKcCuohCa4MuGGA8_Ul7Augvi6muEaXBHrUZgE5C7t6K7qSYE8RiNoAfPHqnvESasBALpCErRgihCGKW6g5vxvoBAIxPhA8_-DWfHxOTRNKb13P6WKhqOVYFu2QDaep8pG9-wUv9glgJo04nJROMoYSO4CJHsNYhB_PMn0jDZ0ZT1loJxmSoQu-O0IDwBQRF47sNPyAFTyFYTniMNTqLNe9oYkS64A3EyTU-LdnWZqi2WYJ_FzxU8TecpS5tR2qd8NpIn5Wyi1n4aesAfQYUPv0TMA4BfxTKmd2HGSsGzB1bg7jDQBshR8R8y_cPSUuFM4WlNZhKo4_I0UstlugGMy3DIcTUOSXAUW3vc8a905z2tcg4JMiYmmVENUxx--n53INSIAYYs-a_x9dRt1ktR2PAefdlOQX_XNalekg-w50SUyFHIDSrWtWgJTpi7JVOSDr50ydCoy-w27Yv7EEzQOn4PZ3RvqmRrBeQxWYJRkBRivd9KIRRjd_uj0qpmHu3Dm0m3RN0EhiUbVvp9x50GM1HODa5JoR80J-2BwMCBNZvLyu71RtdZjuaCBllUQSpaWiMw2C4CFAtj1_rtccb10sr9cGWldIoMa-4CST9GJonkGUzwtyCpPwOC7MMebcb5XCwvLfP9DkXkzL5AmW-LkwKmH9uDeu0EOGLA_VfLaujgkY4Wgs9kCg-6ys4XfpRS77nrmfTgne2BS5X8Lftu76w4ywIVlaa87VhNEtbMVTQnH-QR2uuN7fShx4c2pspaLwgdU-UIms3LMisLIETVv0lDX3z9YtXqHg7Ya-wHLiuJRf890ZPBzHWwYhLPJl_BrNt7In3-KdPSYbvEbPmMcsMymBDY20QYrzS35kle0it9micb47KBIoYNo53s6gUj49qwhTQ6geuj1qE_Hd2NA00XxW2jseThrWNblOGbTWmYnNKjhnDBh6dzQwH535nz__1kT4vXmdhZDKbNKR6X89jELhwVEGZkWds-5i5E5pmNM_cXUvDPxEVjWjkcak-7iEDXDNabdCYzj_Q"

# List files in the /beaverchunks/ folder
$listFilesResponse = curl -X POST https://api.dropboxapi.com/2/files/list_folder `
    --header "Authorization: Bearer $accessToken" `
    --header "Content-Type: application/json" `
    --data "{\"path\": \"/beaverchunks/\"}"

# Parse the response to get file paths
$filePaths = ($listFilesResponse | ConvertFrom-Json).entries | ForEach-Object { $_.path_lower }

# Initialize an array to store sharable links
$sharableLinks = @()

# Loop through each file path to get the sharable link
foreach ($filePath in $filePaths) {
    $createLinkResponse = curl -X POST https://api.dropboxapi.com/2/sharing/create_shared_link_with_settings `
        --header "Authorization: Bearer $accessToken" `
        --header "Content-Type: application/json" `
        --data "{\"path\": \"$filePath\"}"

    # Parse the response to get the URL
    $sharableLink = ($createLinkResponse | ConvertFrom-Json).url
    $sharableLinks += $sharableLink
}

# Output the array of sharable links
$sharableLinks

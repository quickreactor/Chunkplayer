<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="favicon.png" rel="icon" type="image/x-icon">
    <title>Movie Chunk Player</title>
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: Arial, sans-serif;
            background-color: #1a1a1a;
            color: #7f7f7f;
        }

        .container {
            display: flex;
            flex-direction: column;
            /* justify-content: center; */
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
            text-align: center;
            color: #7f7f7f
        }

        .emoji {
            font-family: 'Segoe UI Emoji', 'Apple Color Emoji', 'Noto Color Emoji', 'Android Emoji', 'EmojiSymbols', sans-serif;
        }

        .videoContainer {
            display: flex;
            flex-direction: column;
            justify-content: center;
            background-color: #1a1a1a;
        }

        h1 {
            margin-bottom: 20px;
            align-self: center;
        }

        #videoPlayer {
            display: block;
            max-width: 100%;
            width: 70vw;
            border-radius: 7px;
            object-fit: cover;
            /* box-shadow : 8px 8px 20px rgba( 0, 0, 0, 0.8 ); */


        }

        .videoContainer {
            display: block;
            /* border-radius: 7px; */
            overflow: hidden;
        }

        .date-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px 0;
        }

        #dateInput {
            padding: 10px;
            font-size: 16px;
            margin-top: 5px;
        }

        #dayCount {
            font-size: 24px;
            margin-top: 10px;
        }

        .timer-container {
            text-align: center;
            padding: 20px;
        }

        #countdown-timer {
            font-size: 48px;
            margin-top: 20px;
        }

        #chunkSelector {
            color: #7f7f7f;
            background-color: #1a1a1a;
            width: 4ch;
            padding: 5px;
            font-size: 16px;
            cursor: pointer;
            font-size: 24px;
            border: none;
            text-align: right;
        }

        .selectContainer {
            display: flex;
            justify-content: center;
            align-items: center;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1 class="heading1"></h1>
        <!-- <div class="date-container">
            <label for="dateInput">Start Date</label>
            <input type="date" id="dateInput">
        </div> -->
        <div class="videoContainer">
            <video id="videoPlayer" controls playsinline>
                <source src="" type="video/mp4">
                Your browser does not support the video tag.
            </video>
            <div class="selectContainer">

                <select id="chunkSelector"></select>
                <div id="dayCount"></div>
            </div>
        </div>
        <div class="timer-container">
            <div id="countdown-timer">00:00:00</div>
        </div>
    </div>

    <script>

        const chunkArray = [
            "https://www.dropbox.com/scl/fi/93u2v2d1hlhz455w7693x/beaver00.mp4?rlkey=le4g8623buurr6hp56g3ktesa&raw=1",
            "https://www.dropbox.com/scl/fi/g7ftx1h9wnuln3w7epz1f/beaver01.mp4?rlkey=w1k33nblszqys058akwj1o4e5&raw=1",
            "https://www.dropbox.com/scl/fi/1h6e0iqv86f50ef05n377/beaver02.mp4?rlkey=8ln2z2ws40neyhwxu3c4l2uvh&raw=1",
            "https://www.dropbox.com/scl/fi/k125w4vyz6l3vm3zxfyjq/beaver03.mp4?rlkey=wnxxm61jmteqhy0x02gih9v0n&raw=1",
            "https://www.dropbox.com/scl/fi/i8h8xgclz91drgk1lfboo/beaver04.mp4?rlkey=j4ytawo74qexyplm0975yb659&raw=1",
            "https://www.dropbox.com/scl/fi/pvapryf5glv98vsr9b00k/beaver05.mp4?rlkey=rdm9vsybmsuadlyo2t6vzd63c&raw=1",
            "https://www.dropbox.com/scl/fi/4c68uhbr7qhwoh9e8ql6m/beaver06.mp4?rlkey=zwnzm4wd605zox2n1c1m9g6f6&raw=1",
            "https://www.dropbox.com/scl/fi/wlw0ijoq0n4tp7vhpp5sh/beaver07.mp4?rlkey=1l9sweblot5wgur858x3bv07s&raw=1",
            "https://www.dropbox.com/scl/fi/4hlbefnazicmkfooyjf84/beaver08.mp4?rlkey=506d852aj0ijfrne1t941jvkd&raw=1",
            "https://www.dropbox.com/scl/fi/sky968hywlrtcrox9rnrx/beaver09.mp4?rlkey=9991oggt9eb0vuzvi30v2hc7m&raw=1",
            "https://www.dropbox.com/scl/fi/yfxi0w7u05ln8o0g8hyvr/beaver10.mp4?rlkey=hg5lg1913gzfwv9tl2wlbivj9&raw=1",
            "https://www.dropbox.com/scl/fi/z77kcimrdznybw42o4wii/beaver11.mp4?rlkey=gwya3xsseoj2cyauvcr3h5fwh&raw=1",
            "https://www.dropbox.com/scl/fi/ak747oe721a9ri0wer5ef/beaver12.mp4?rlkey=f07cw2ij27xn6atoietsg4jrs&raw=1",
            "https://www.dropbox.com/scl/fi/38l0tpbjb8a0yd4ka4yd8/beaver13.mp4?rlkey=pk65dd9790vh4baq3kcm3wx0p&raw=1",
            "https://www.dropbox.com/scl/fi/yn4d2tfy5nf1agk3sq5at/beaver14.mp4?rlkey=b58ohj7o7biuij3umcsk0mayo&raw=1",
            "https://www.dropbox.com/scl/fi/9fux2z07tcmvzf4p9r2ka/beaver15.mp4?rlkey=qmfudkyn8qie8yp02yrg0j2pr&raw=1",
            "https://www.dropbox.com/scl/fi/m1gnsee52pglxath62j92/beaver16.mp4?rlkey=emydtsvchbw2ex0kk220lz112&raw=1",
            "https://www.dropbox.com/scl/fi/6cuchyr1klkww5f1x2tai/beaver17.mp4?rlkey=ok726g94tx8to77g71yx01eor&raw=1",
            "https://www.dropbox.com/scl/fi/1xemogq0lfjf1gvanxcxm/beaver18.mp4?rlkey=5ktjrmm7qiad4c4dr3jzobmtw&raw=1",
            "https://www.dropbox.com/scl/fi/hmvfdq9smxthfxj1qkq78/beaver19.mp4?rlkey=yzph2fisojrlh1foklrbyphyj&raw=1",
            "https://www.dropbox.com/scl/fi/rbcvi7admp7c7y9k0lf12/beaver20.mp4?rlkey=u1n0vdi1004te20542glil0w9&raw=1",
            "https://www.dropbox.com/scl/fi/ec8cut96ay1em18ym8tue/beaver21.mp4?rlkey=eaca6pu612ee1ejdx0g4qbawo&raw=1"
        ]
        const dateInput = document.getElementById('dateInput');
        const videoPlayer = document.getElementById('videoPlayer');
        const dayCountDisplay = document.getElementById('dayCount');
        let container = document.querySelector(".container");
        let videoContainer = document.querySelector(".videoContainer");
        let timerContainer = document.querySelector(".timer-container");
        let heading1 = document.querySelector(".heading1");
        const selector = document.getElementById('chunkSelector');

        function hideElement(el) {
            el.style.display = 'none';
        }

        function isTodaySunday() {
            const today = new Date();
            return today.getDay() === 0;
        }

        function isPastMidnight() {
            const now = new Date();
            const currentHour = now.getHours();

            // Check if the current hour is between 0 (midnight) and 8 (8 AM)
            return currentHour >= 0 && currentHour < 8;
        }

        function updateVideo() {

            videoContainer.style.display = "flex";
            timerContainer.style.display = "none";
            heading1.innerText = ``;
            // Set the default date to July 22, 2024 in NZ timezone
            const defaultDate = new Date('2024-07-22T00:00:00+12:00');
            const now = new Date(new Date().toLocaleString("en-US", { timeZone: "Pacific/Auckland" }));

            let daysPassed = 0;
            for (let d = new Date(defaultDate); d <= now; d.setDate(d.getDate() + 1)) {
                if (d.getDay() !== 0) { // Skip Sundays (0 is Sunday in JavaScript)
                    daysPassed++;
                }
            }

            const videoNumber = daysPassed.toString().padStart(2, '0');

            videoPlayer.src = chunkArray[videoNumber - 1];
            dayCountDisplay.textContent = `/${chunkArray.length}`;
            // dayCountDisplay.textContent = `${daysPassed}/${chunkArray.length}`;

            // SELECTOR STUFF
            // Populate the dropdown

            for (let i = 0; i < daysPassed; i++) {
                const option = document.createElement('option');
                option.value = i+1;
                option.textContent = i+1;
                selector.prepend(option);
            }

            // Set default value to 3
            selector.value = 3;

            // Event listener for dropdown changes
            selector.addEventListener('change', function () {
                const selectedValue = this.value;
                const videoNumber = selectedValue.toString().padStart(2, '0');
                videoPlayer.src = chunkArray[videoNumber - 1];
            });
            selector.value = daysPassed;
        }

        function sundayTest() {
            hideElement(videoContainer); //flex
            heading1.innerText = `
            Today is Sunday, the day of rest, no chunk today!
            `;
        }


        function lockdown() {
            hideElement(videoContainer); //flex
            timerContainer.style.display = "block";
            heading1.innerText = `
            Today's chunk is currently locked, it will unlock in
            `;
            updateCountdown();
        }


        // DO THE THING
        if (isTodaySunday()) {
            sundayTest();
        } else if (isPastMidnight() === true) {
            lockdown();
        }
        else {
            updateVideo();
        }

        // TIMER STUFF

        function updateCountdown() {
            const now = new Date();
            const nextEightAM = new Date(now);
            nextEightAM.setHours(8, 0, 0, 0);

            if (now.getHours() >= 8) {
                nextEightAM.setDate(now.getDate() + 1);
            }

            const timeDifference = nextEightAM - now;
            // Unlock if it's 8AM or later
            if (isPastMidnight() === false) {
                updateVideo()
            } else {
                const hours = Math.floor((timeDifference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((timeDifference % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeDifference % (1000 * 60)) / 1000);

                const formattedHours = String(hours).padStart(2, '0');
                const formattedMinutes = String(minutes).padStart(2, '0');
                const formattedSeconds = String(seconds).padStart(2, '0');

                document.getElementById('countdown-timer').textContent = `${formattedHours}:${formattedMinutes}:${formattedSeconds}`;
                setTimeout(updateCountdown, 1000);
            }
        }
    </script>
</body>

</html>